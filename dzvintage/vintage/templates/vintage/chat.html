{% extends 'vintage/base.html' %}
{% load static %}

{% block style %}
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css"
/>
<style>
    .chatbox{
        margin: auto;
        width: 70%;
        height: 70vh;
        background-color: whitesmoke;
        border: 1px solid black;
    }
    .chatbox > div{
        border: 1px solid black;
    }
    .you-sent{
        background-color: #3240ff;
        padding: 10px 20px;
        border-radius: 10px 10px 0 10px;
        margin: 10px 10px 10px auto;
        width: fit-content;
        max-width: 70%;
        color: white;
        font-weight: 600;
        /* text-align: end; */
    }
    .other-sent{
        background-color: #a2a2a2;
        padding: 10px 20px;
        border-radius: 10px 10px 10px 0;
        margin: 10px auto 10px 10px;
        width: fit-content;
        max-width: 70%;
        color: white;
        font-weight: 600;
        /* text-align: start; */
    }
    .message-container .time-of-message{
        color: white;
    }
    .message-container:hover .time-of-message{
        color: #a6a6a6;
    }

</style>
<script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>

{% endblock %}
{% block hero %}
      <!-- ======= Hero Section ======= -->
  <section id="hero" style="background-color: black; height: 90px;">
    <div class="hero-container" data-aos="zoom-in" data-aos-delay="100">
      
    </div>
  </section><!-- End Hero Section -->

{% endblock %}

{% block main %}

<main id="main">

    <section id="">
        <div class="container" style="">
            <div class="chatbox d-flex">
                <div class="" style="flex-basis: 35%;">
                    <div class="d-flex justify-content-center" style="border: 0; border-bottom: 1px solid black;">
                        <!-- <img src="{{profile.picture.url}}" alt="" style="width: 50px; height: 50px; border-radius: 50%;"> -->
                        <span style="font-weight: 600; margin:10px auto"> {{user.username}} </span>
                    </div>
                    {% for conversation in conversations %}
                    <a href="{% url 'chat' conversation.other_user conversation.post.id  %}" ><div class="d-flex" style="margin: 10px auto;">
                        <div style="width: 40px; height: 40px; margin: 5px auto; " >
                            <img src="{{conversation.post.image.url}}" width="40" height="40" style="border-radius: 50%;width: 40px;height: 40px;">
                        </div>
                        <div style="width: calc(100% - 60px); text-align: start; margin: 5px auto;">
                            <span style="font-weight: 600; margin:10px auto"> {{conversation.other_user}} </span><br>
                            <span style="margin:10px auto"> {{conversation.last_message}} </span>
                        </div>
                    </div></a>
                    {% endfor %}
                </div>
                    
                <div style="flex-basis: 65%; background-color: white; height: 100%;display: flex; flex-direction: column">
                    
                    <div class="d-flex" style="padding: 10px 10px; background-color: whitesmoke;">
                        <div style="width: 40px; height: 40px; margin: 5px auto; " >
                            <img src="{{product.image.url}}" width="40" height="40" style="border-radius: 50%;width: 40px;height: 40px;">
                        </div>
                        <div style="width: calc(100% - 60px); text-align: start; margin: 5px auto;">
                            <span style="font-weight: 600; margin:10px auto"> {{product.title}} </span><br>
                        </div>
                    </div>
                    <!-- {% if messages %} -->
                    <div id="thebox-of-chatbox" style="padding : 12px 12px; overflow-y: auto; ">
                        {% for message in messages %}
                            {% if message.sender == user %}
                            <div class="message-container" style="border: 0; height: fit-content; margin: 20px auto; text-align: end;">
                                <span class="time-of-message" style="font-size: 12px; ">{{message.timestamp|date:'d M H:i'}}</span>
                                <span class="you-sent" style="margin:10px auto"> {{message.message}}  </span>
                            </div>
                            {% else %}
                            <div class="message-container" style="border: 0; height: fit-content; margin: 20px auto; text-align: start;">
                                <span class="other-sent" style="margin:10px auto"> {{message.message}} </span>
                                <span class="time-of-message" style="font-size: 12px; ">{{message.timestamp|date:'d M H:i'}}</span>

                            </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                    
                    <div style="border: 0; border-top: 1px solid black; padding: 10px 10px; background-color:whitesmoke; height: fit-content">
                        <form action="{% url 'chat' other_user product.id %}" method="POST" style="">
                            {% csrf_token %}
                            <div class="d-flex">
                                <input type="text" name="message" id="message-input" style="width: 100%; border: 0; border-radius: 10px; padding: 10px 20px; outline: none;">
                                <button type="submit" style="border: 0; background-color: transparent; margin: 0 0 0 10px; outline: none;"><i class="bi bi-send" style="font-size: 20px;"></i></button>
                            </div>
                        </form>
                    </div>
                    <!-- {% endif %} -->
                </div>
            </div>
        </div>
    </section>



</main><!-- End #main -->

{% endblock %}

{% block scripts %}
<script>
    document.getElementById('message-input').focus();
    var thebox = document.getElementById('thebox-of-chatbox');
    thebox.scrollTop = thebox.scrollHeight;
    // document.getElementById('header').classList.add('header-scrolled');
    // setTimeout(fixbugheader, 1000);
    // document.getElementsByTagName('main')[0].style.marginTop="155px";
    // function fixbugheader(){
    //     document.getElementById('header').classList.remove('header-transparent');
    //     document.getElementById('header').classList.add('header-scrolled');

    // }
</script>
{% endblock %}