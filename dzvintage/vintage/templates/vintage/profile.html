{% extends 'vintage/base.html' %}
    {% load static %}
{% block style %}
<style>
    @media (max-height:800px){
        .soufel-ricamo{
            margin-top: 0!important;
            margin: 45px auto!important;
        }
    }
    .soufel-ricamo{
        margin: 50px auto;
        margin-top: 80px;
    }

    html, body, main{
        height: 100%;
    }


    #header{
        display: none!important;
    }
    #footer{
        display: none!important;}
    main{
        /* margin: -1px; */
        padding-top: 0;
    }
    .main-main{
        width: 100%;
        background-color: #202020;
        height: 100%;
        overflow-x: auto;
    }
    .profile-informations{
        color: white;
    }
    .sidebar-menu{
        /* position: fixed; */
        background-color: #202020;
        border: 1px solid #3f3f3f;
        border-radius: 3px;
        box-shadow: 0 1px 1px rgba(0,0,0,.05);
        margin: 0;
        /* margin-bottom: 20px; */
        /* margin-top: 20px; */
        padding: 0;
        width: 20%;
        color: white!important;
        height: 100%;
        min-width: 300px;
    }
    .sidebar-menu-inner{
        padding: 0;

    }
    .icon, .title{
        color: white!important;
    }
    .title{
        margin-left: 8px;
    }
    .profile-picture{
        color: white;
        width: 30%;
    }
    .sidebar-menu-inner ul{
        padding: 0;
    }
    ul.sidebar-nav{
        list-style: none;
        margin: 0;
        padding: 0;
    }
    ul.sidebar-nav li{
        padding: 20px 50px;
        border-radius: 10px;
        transition: all 0.3s ease-in-out;
    }
    .profile-informations{
        width: fit-content;
        min-width: 60%;
    }
    .special-ricamo{
        text-align: center;
    }
    label{
        cursor: pointer;
    }
    p > input{
        padding: 6px 30px;
        border-radius: 5px;
        background-color: #474747;
        border: none;
        /* border-bottom: 1px solid white; */
        color: white;
        /* width: 100%; */
    }
    .pfff{
        padding: 6px 2px;
    }
    p{
        width: 100%;
    }
    .profile-wrapper{
        display: flex;
        justify-content: space-around;
        margin-top: 15px;
    }
    .infos-personnelles{
        display: flex;
        /* justify-content: space-between; */
    } 
    @media (max-width:768px){
        .profile-wrapper{
            display: block;
        }
        section{
            margin-top: 30px!important;
        }
        .profile-picture{
            width: 90%;
            margin: auto;
        }
        .profile-picture form h4{
            text-align: center;
        }
        .profile-picture form{
            text-align: center;
        }
        .profile-picture img, .profile-picture-img{
            width: 120px!important;
            height: 120px!important;
        }
        label{
            margin: auto;
            width: fit-content;
            text-align: center;
        }
        .infos-personnelles{
            justify-content: center;
            margin-top: 0!important;
        }
        #infos-1{
            margin-top: 50px!important;
        }
        .profile-informations{
            width: 90%;
            margin: auto;
        }
        .profile-informations h4{
            display: none;
        }
        .submit-form{
            margin: auto;
            display: block;
        }
    }
    li:hover{
        background-color: #424242;
    }
    .infos-personnelles{
        margin-top: 60px;
    }
    textarea{
        padding: 6px 30px;
        border-radius: 5px;
        background-color: #474747;
        border: none;
        color: white;
        overflow: hidden;
        /* width: 100%; */
        /* resize: none; */
        height: 100px;
    }
    section .container{
        min-width: 0!important;
    }
    .submit-form{
        padding: 8px 12px;
        border-radius: 10px;
        border-color: #50dcf3;
        background-color: #50dcf3;
        /* font-weight: 600; */
        font-size: 15px;
        color: white;
        transition: all 0.1s ease-in-out;
    }
    .submit-form:hover{
        background-color: black;
        border-color: white;
    }
    @media(max-width: 768px){
        .sidebar-menu{
            width: 100px!important;
            min-width: 0;
        }
        .title{
            display: none;
        }
        #ricamo1{
            display: none!important;
        }
        #ricamo2{
            display: block!important;
        }
        ul > a{
        color: white;
        font-size: 22px;
        transition: all 0.3s ease-in-out;
        }
        ul > a:hover i{
            color: #50dcf3;
            transform: scale(1.1);
        }
        ul.sidebar-nav li{
            padding: 18px 33px;
            border-radius: 10px;
            transition: all 0.3s ease-in-out;
        }
    }
    #ricamo2{
        display: none;
    }
    @media(max-width:1250px){
        section .container{
            width: 97%!important;
        }
        p > input {
            padding: 6px 12px;

        }
        p{
            font-size: 12px;
        }
        .profile-wrapper{
            justify-content: space-between;
        }

    }
    main{
        height: 100%;
    }
    section .container{
        width: 85%;
        min-width: 600px;
    }
    .profile-picture img, .profile-picture-img{
        width: 150px; height: 150px; border-radius: 50%; text-align:left; border: 2px solid white;
    }
    .profile-picture-img{
        background-position: center;
        background-size: 100%;   
        background-repeat: no-repeat;     
    }
    .btn-primary:hover{
        background-color: #202020;
        border-color: white;
    }
    .btn-primary{
        /* background-color: ; */
    }



    #menu_signal_eval{
        /* display: none; */
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 20px;
        
        width: 350px;
        /* height: 250px; */
        z-index: 9999;
        background-color: #191919;
        border: 1px solid #4f4e4e;
        border-radius: 12px;
    }
    .title-description-menu{
        color: white;
    }
    .icon-description-menu, .title-description-menu{
        color: white;
        font-size: 16px;
    }
    #menu_signal_eval li:hover{
        background-color: #3f3f3f;
        cursor: pointer;
    }
    #menu_signal_eval ul{
        width: 100%;
    }

    #menu_signal_eval li{
        width: 100%;
        height: 60px;
        border-radius: 10px;
    }
    #sectionn{
        margin: 0!important;
    }
    #menu_signal_eval > span > i {
        font-size: 16px;
    }
    #menu_signal_eval > span > i.bi-x::before {
        color: white;
        cursor: pointer;
    }










</style>
{% endblock %}
{% block main %}
<main id="main" class="d-flex">
    <div id="menu_signal_eval" style="display: none;">
        <span id="close_menu_ev" style="float: right;" class="">
            <i style="color: white;" class="bi bi-x"></i>
        </span>

        <div class="d-flex justify-content-center">
            <ul style="list-style: none; padding-left: 0;margin-bottom: 0;">
                <a href="https://t.me/vintagedzBot" target="_blank">
                    <li>
                        <span class="icon-description-menu"><i style="color:blue; font-size: 25px;" class="bi bi-telegram"></i></span>
                        <span class="title-description-menu">Confirmer via Telegram (Auto)</span>
                    </li>
                </a>
                
                <a href="sms:+213791894185?&body=OK">
                    <li>
                        <span class="icon-description-menu"><i style="color: #50dcf3;font-size: 25px;" class="bi bi-phone"></i></span>
                        <span class="title-description-menu">Envoyer "OK" au 0791 89 41 85</span>
                    </li>
                </a>
                
            </ul>
        </div>
    </div>

    <div class="sidebar-menu justify-content-center d-flex">

        <div class="sidebar-menu-inner">
            <div class="soufel-ricamo">
               
                <h1 id="ricamo1" class="special-ricamo"><a style="color: white;" href="{% url 'index'%}">Vintage<span style="color: #50dcf3;">DZ</span></a></h1>
                <h1 id="ricamo2" class="special-ricamo"><a style="color: #50dcf3; text-align: center;" href="{% url 'index'%}">V</a></h1>
            </div>
        
            <ul class="sidebar-nav">
                <a href="{% url 'profile' %}">
                <li class="active">
                    
                        <span class="icon"><i class="bi bi-person"></i></span>
                        <span class="title">Profil</span>
                    
                </li></a>
                <a href="{% url 'index' %}">
                    <li class="">

                        <span class="icon"><i class="bi bi-house"></i></span>
                        <span class="title">Accueil</span>
                    
                    </li>
                </a>

                <a href="{% url 'annonces' %}">
                    <li>
                        <span class="icon"><i class="bi bi-list"></i></span>
                        <span class="title">Mes Annonces</span>
                    
                    </li>
                </a>
                <a href="{% url 'add' %}">
                    <li>
                        <span class="icon"><i class="bi bi-plus"></i></span>
                        <span class="title">Ajouter une Annonce</span>
                    </li>
                </a>
                <a href="{% url 'chat' 'inbox' '1' %}">
                    <li class="active">
                        
                            <span class="icon"><i class="bi bi-chat"></i></span>
                            <span class="title">Messagerie</span>
                        
                    </li>
                </a>
    

                <a href="{% url 'password_change' %}">
                    <li>
                        <span class="icon"><i class="bi bi-lock"></i></span>
                        <span class="title">Mot de passe</span>
                    </li>
                </a>
                <a href="{% url 'logout' %}">
                    <li>
                        <span class="icon"><i class="bi bi-door-open"></i></span>
                        <span class="title">Déconnexion</span>
                    </li>
                </a>

            </ul>
        </div>
    </div>
    <div class="main-main">
        <section>
            <div class="container">
                <a href="{% url 'page' user.username %}" class="btn btn-primary" style="min-width: 30px ;  font-size: 14px; font-weight: 600;margin-left: 15px;"><i class="bi bi-eye"></i></a>

            <div class="profile-wrapper">

                <div class="profile-picture">

                <form id="picture-form" action="" enctype="multipart/form-data" method="POST">{% csrf_token %}

                    <h4>Informations Personnelles</h4>
                    
                    <label style="margin-top: 30px;" for="picture" style="cursor: pointer;">
                        <!-- <img src="{{profile.picture.url}}"> -->
                        <div class="profile-picture-img" style="background-image: url('{{profile.picture.url}}');"></div>
                    </label>
                    <input type="file" name="picture" id="picture" style="display: none;">
                    <!-- <span style="display: block; font-size: 12px; text-align: left; text-indent: 5px; color: #717171;">Cliquez pour la modifier</span> -->
                    <small style="display: block;color: #717171;">Cliquez pour la modifier</small>
                </form>
                    <div id="infos-1" class="infos-personnelles">
                        <div class="labels">
                            <p class="pfff">Nom</p>
                            <p class="pfff">Prénom</p>
                            
                        </div>
                        <div class="inputs">
                            <form id="infos-form" action="" method="POST">{% csrf_token %}

                            <p><input name="last_name" type="text" value="{{user.last_name}}"></p>
                            <p><input name="first_name" type="text" value="{{user.first_name}}"></p>
                           
                        </div>
                    </div>


                </div>
                <div class="profile-informations">
                    <h4>Modifier votre Profil</h4>
                    {% if error %}
                    <p style="color: red;">{{error}}</p>
                    {% endif %}
                    <div class="infos-personnelles" style="margin-top: 60px;">
                        <div class="labels">
                            <!-- <p class="pfff">Nom</p>
                            <p class="pfff">Prénom</p> -->
                            <p class="pfff">Email</p>
                            <p class="pfff">Username</p>
                            <p class="pfff">Téléphone</p>
                            <p class="pfff">Ville</p>
                            <p class="pfff">Bio</p>
                        </div>
                        <div class="inputs">
                            <!-- <p class="pfff">{{user.last_name}}</p>
                            <p class="pfff">{{user.first_name}}</p> -->
                            {% if user.email %}
                            <p class="pfff">{{user.email}}</p>
                            {% else %}
                            <p><input id="email_field" name="email" type="text" value="{{user.email}}"></p>
                            {% endif %}
                            <p><input name="username" type="text" value="{{user.username}}" required></p>
                            <p><input id="phone_number" name="phone_number" pattern="0[5-7]{1}[0-9]{8}" type="tel"
                                 {% if profile.phone_number %} value="{{profile.phone_number}}" {% else %} placeholder="Numéro de Télephone" {% endif %}>
                                 {% if profile.phone_confirmed %}<i style="color: #50dcf3; font-size: 20px;margin-left: 3px;" class="bi bi-check-circle-fill"></i>{% elif profile.phone_number and not profile.phone_confirmed %}<span id="span_signal_eval"><i class="bi bi-exclamation-circle-fill" style="color: #aab300; font-size: 20px;margin-left: 3px;cursor: pointer;"></i></a>{% endif %}</p>
                            <p><select name="wilaya" id="city" style="padding: 6px 30px; border-radius: 5px; background-color: #474747; border: none; color: white;">
                                <option disabled selected>wilaya</option>
                                {% for key, value in wilayas %}
                                <option value="{{key}}" {% if key == profile.wilaya %} selected {% endif %}>{{value}}</option>
                                {% endfor %}
                            </select></p>
                            <p>
                                <textarea name="bio" maxlength="150" id="myTextarea">{% if profile.bio %}{{profile.bio}}{% else %}{% endif %}</textarea>
                                <small style="display: block;color: #717171;" id="wordCount"></small>
                            </p>

                        </div>
                    </div>

                    <button type="submit" class="submit-form" style="margin-top: 30px;">Modifier</button>


                </form>
                


            </div>
            </div>
        </section>

    </div>
</main>
{% endblock %}
{% block scripts %}
<script>
    // document.getElementById("main").style.marginTop = "90px";
    var input_pic = document.getElementById("picture");
    var form_pic = document.getElementById("picture-form");
    input_pic.addEventListener("change", function(){
        form_pic.submit();
    })


    var textarea = document.getElementById("myTextarea");
    var wordCountDisplay = document.getElementById("wordCount");
    wordCountDisplay.textContent = textarea.value.length + "/150";

    textarea.addEventListener("input", function() {
        var text = textarea.value;
        var wordCount = text.length;
        wordCountDisplay.textContent = wordCount + "/150";
    });
    var phone = document.getElementById("phone_number");
    if (phone.value.trim()){
        phone.value = "0"+phone.value.slice(4, phone.value.length);
    }
    var email = document.getElementById("email_field");
    var form = document.getElementById("infos-form");
    form.addEventListener("submit", function(e){
        if (email == null){
            phone.setAttribute("required", "true");
        }
        if (email){
            if ((email.value.trim() == "") && (phone.value.trim() == "")){
                e.preventDefault();
                alert("Veuillez remplir au moins un champ (Email ou Téléphone)");
            }
        }
    })
    var main = document.getElementsByClassName('main-main')[0];
    var signal_eval = document.getElementById("span_signal_eval");
    if (signal_eval){
        signal_eval.addEventListener("click", show_menu_signal_eval);
    }
    var menu_si_ev = document.getElementById("menu_signal_eval");
    var close_menu_ev = document.getElementById("close_menu_ev");
    if (close_menu_ev) close_menu_ev.addEventListener("click", show_menu_signal_eval);
    function show_menu_signal_eval(e){
        if (menu_si_ev.style.display == "none") {
            menu_si_ev.style.display = "block";
            main.setAttribute("style", "filter: blur(5px);")  
        }else{
            menu_si_ev.style.display = "none";
            main.setAttribute("style", "filter: blur(0px);")
        }
    }

</script>
{% endblock %}